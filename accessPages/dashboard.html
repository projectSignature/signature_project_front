<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>みかん</title>
    <style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f9f9f9;
        height: 100%; /* 高さを100%に固定 */
        overflow: hidden; /* body自体のスクロールを無効化 */
    }

    html {
        height: 100%;
    }

h2 {
   text-align: center;
   margin-top: 20px;
   color: #007BFF;
   font-size: 2rem;
}

        header {
            background-color: #007BFF;
            color: white;
            padding: 10px 20px;
            text-align: center;
        }

        header h1 {
            margin: 0;
        }

        .container {
      height: 100%; /* 高さを固定 */
      display: flex;
      flex-direction: column;
      overflow: hidden;
  }


        .story-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            padding: 15px;
        }

        .story-card img {
            max-width: 100%;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .story-card h3 {
            margin: 0 0 10px;
            color: #333;
        }

        .story-card p {
            margin: 0 0 10px;
            color: #555;
        }

        .add-story {
            display: block;
            background-color: #007BFF;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 20px 0;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            text-align: center;
        }

        .add-story:hover {
            background-color: #0056b3;
        }

        /* モーダルの全体スタイル */
   #addStoryModal {
       display: none;
       position: fixed;
       top: 0;
       left: 0;
       width: 100%;
       height: 100%;
       background-color: rgba(0, 0, 0, 0.5);
       z-index: 1000;
       overflow-y: auto;
   }

   /* モーダルのコンテンツ */
   .modal-content {
       position: relative;
       margin: 50px auto;
       padding: 20px;
       max-width: 400px;
       background: #fff;
       border-radius: 8px;
       box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
   }

   /* 見出し */
   .modal-content h3 {
       margin: 0 0 20px;
       color: #007BFF;
       text-align: center;
   }

   /* フォーム全体 */
   #addStoryForm {
       display: flex;
       flex-direction: column;
   }

   /* ラベル */
   label {
       margin-bottom: 5px;
       font-weight: bold;
       color: #333;
   }

   /* 入力フィールド */
   input[type="text"],
   input[type="date"],
   textarea,
   input[type="file"] {
       width: 90%;
       padding: 10px;
       margin-bottom: 15px;
       border: 1px solid #ccc;
       border-radius: 5px;
       font-size: 16px;
   }

   input[type="file"] {
       padding: 5px; /* ファイル入力のデザインを調整 */
   }

   textarea {
       height: 100px;
       resize: none; /* サイズ変更を無効化 */
   }

   /* ボタン */
   button {
       padding: 10px 20px;
       font-size: 16px;
       color: white;
       background-color: #007BFF;
       border: none;
       border-radius: 5px;
       cursor: pointer;
       margin-top: 10px;
   }

   button:hover {
       background-color: #0056b3;
   }

   /* 閉じるボタン */
   .close-button {
       background-color: #dc3545;
       color: white;
       border: none;
       padding: 10px;
       font-size: 14px;
       cursor: pointer;
       border-radius: 5px;
       margin-top: 10px;
   }

   .close-button:hover {
       background-color: #b02a37;
   }

   .notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 15px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    font-size: 16px;
    font-weight: bold;
    z-index: 1000;
    opacity: 0;
    transform: translateY(-20px);
    transition: opacity 0.5s ease, transform 0.5s ease;
    pointer-events: none;
}

.notification.show {
    opacity: 1;
    transform: translateY(0);
}

.notification.success {
    background-color: #28a745; /* 緑: 成功 */
    color: white;
}

.notification.error {
    background-color: #dc3545; /* 赤: エラー */
    color: white;
}

.notification.info {
    background-color: #007BFF; /* 青: 情報 */
    color: white;
}

       /* スピナー */
       .spinner {
           display: none; /* 初期状態は非表示 */
           position: fixed;
           top: 50%;
           left: 50%;
           transform: translate(-50%, -50%);
           z-index: 1001;
       }

       .spinner div {
           width: 40px;
           height: 40px;
           margin: 0 auto;
           border: 4px solid #007BFF;
           border-top: 4px solid transparent;
           border-radius: 50%;
           animation: spin 1s linear infinite;
       }

       @keyframes spin {
           from {
               transform: rotate(0deg);
           }
           to {
               transform: rotate(360deg);
           }
       }

       .date-group {
       margin-bottom: 30px;
   }

   .date-header {
       font-size: 1.5rem;
       color: #007BFF;
       margin-bottom: 10px;
   }

   .image-container {
       display: flex;
       flex-wrap: wrap;
       gap: 15px;
   }

   #galleryContainer {
       flex-grow: 1; /* 残りの領域を占める */
       overflow-y: auto; /* Y方向のスクロールを有効に */
       padding: 20px;
       max-width: 1200px;
       margin: 0 auto;
       background-color: #fff;
       border-radius: 8px;
       box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
   }

    .date-group {
        margin-bottom: 30px;
    }

    .date-header {
        font-size: 1.5rem;
        color: #007BFF;
        margin-bottom: 10px;
        border-left: 5px solid #007BFF;
        padding-left: 10px;
        background-color: #e9f5ff;
        padding: 10px;
        border-radius: 5px;
    }

    .image-container {
        display: flex;
        gap: 20px;
        overflow-x: auto; /* 横スクロールを有効に */
        padding-bottom: 10px;
    }

    .image-container::-webkit-scrollbar {
        height: 8px; /* 横スクロールバーの高さ */
    }

    .image-container::-webkit-scrollbar-thumb {
        background: #007BFF; /* スクロールバーの色 */
        border-radius: 4px;
    }

    .image-container::-webkit-scrollbar-track {
        background: #f0f0f0; /* スクロールバーの背景色 */
    }

    .image-card {
        min-width: 200px;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        text-align: center;
        background-color: #fff;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .image-card:hover {
        transform: scale(1.05);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }

    .image-card img {
        width: 100%;
        height: auto;
    }

    .image-card p {
        margin: 0;
        padding: 10px;
        font-size: 0.9rem;
        color: #555;
        background-color: #f9f9f9;
        border-top: 1px solid #ddd;
    }

    footer {
        text-align: center;
        padding: 20px;
        font-size: 0.9rem;
        color: #888;
        border-top: 1px solid #ddd;
        margin-top: 30px;
    }
    .escape-button {

                bottom: 20px;
                right: 20px;
                background-color: #dc3545;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 8px;
                font-size: 1rem;
                font-weight: bold;
                cursor: pointer;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
                transition: background-color 0.3s, transform 0.2s ease-in-out;
                z-index: 1000;
            }

            .escape-button:hover {
                background-color: #b02a37;
                transform: scale(1.1);
            }

   </style>

</style>

    </style>
</head>
<body>
    <header>
        <h1>AYANOストリーズ</h1>
    </header>

    <div class="container">

        <button class="add-story" onclick="openAddStoryModal()">+ ストーリーを追加</button>

        <!-- ストーリーカード -->
        <div id="storyList">
            <!-- JavaScriptで動的にストーリーを追加 -->
        </div>
        <!-- モーダル -->
        <div id="addStoryModal">
            <div class="modal-content">
                <h3>ストーリーを追加</h3>
                <form id="addStoryForm">
                    <label for="date">日付</label>
                    <input type="date" id="date" name="date" required>

                    <label for="comment">コメント</label>
                    <textarea id="comment" name="comment"></textarea>

                    <label for="image">画像</label>
                    <input type="file" id="image" name="image" accept="image/*" required>

                    <button type="submit">保存</button>
                    <button type="button" class="close-button" onclick="closeAddStoryModal()">閉じる</button>
                </form>
            </div>
        </div>

        <div id="notification" class="notification"></div>
    <div id="spinner" class="spinner">
        <div></div>
    </div>

    <button class="escape-button" onclick="escapeToYahoo()">脱出</button>

    <div id="galleryContainer">
        <h2>おかず集</h2>
        <div id="imageGallery"></div>
    </div>
    </div>










    <script>


    const authKey = localStorage.getItem('authKey');

    if (!authKey) {
        // ログインキーが無い場合はログインページへリダイレクト
        window.location.href = 'https://www.yahoo.co.jp';
    }


    // モーダルを開く
function openAddStoryModal() {
  document.getElementById('addStoryModal').style.display = 'block';
}

// モーダルを閉じる
function closeAddStoryModal() {
  document.getElementById('addStoryModal').style.display = 'none';
}

// ストーリーを追加
document.getElementById('addStoryForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData();
    formData.append('date', document.getElementById('date').value);
    formData.append('comment', document.getElementById('comment').value);
    formData.append('image', document.getElementById('image').files[0]);

    try {
        showSpinner(); // 処理中のスピナーを表示

        // 非同期リクエストの実行
        const response = await fetch('https://squid-app-ug7x6.ondigitalocean.app/access/upload', {
            method: 'POST',
            body: formData,
        });

        const result = await response.json();

        if (response.ok) {
            showNotification('ストーリーが保存されました!', 'success');
            closeAddStoryModal();
        } else {
            showNotification('エラー: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('エラー:', error);
        showNotification('ストーリーの保存中にエラーが発生しました', 'error');
    } finally {
        hideSpinner(); // 処理終了後にスピナーを非表示
    }
});


document.addEventListener('DOMContentLoaded', () => {
        // 今日の日付をフォーマット
        const today = new Date().toISOString().split('T')[0];
        const dateInput = document.getElementById('date');

        // 初期値として今日の日付を設定
        if (dateInput) {
            dateInput.value = today;
        }
    });

    function closeAddStoryModal() {
        document.getElementById('addStoryModal').style.display = 'none';
    }


    // 通知を表示する関数
    function showNotification(message, type = 'info') {
        const notification = document.getElementById('notification');
        notification.textContent = message;

        // 状態別のスタイルを適用
        notification.className = `notification ${type} show`;

        // 一定時間後に非表示
        setTimeout(() => {
            notification.classList.remove('show');
        }, 1000); // 3秒後に消える
    }

    // スピナーを表示する関数
    function showSpinner() {
        document.getElementById('spinner').style.display = 'block';
    }

    // スピナーを非表示にする関数
    function hideSpinner() {
        document.getElementById('spinner').style.display = 'none';
    }

    document.addEventListener('DOMContentLoaded', async () => {
        const galleryContainer = document.getElementById('imageGallery');

        try {
            // サーバーから全画像を取得
            const response = await fetch('https://squid-app-ug7x6.ondigitalocean.app/access/images');
            const data = await response.json();

            if (response.ok) {
                // 日付ごとに分類
                const imagesByDate = {};
                data.images.forEach(image => {
                    if (!imagesByDate[image.date]) {
                        imagesByDate[image.date] = [];
                    }
                    imagesByDate[image.date].push(image);
                });

                // 日付ごとに表示
                for (const [date, images] of Object.entries(imagesByDate)) {
                    const dateGroup = document.createElement('div');
                    dateGroup.classList.add('date-group');

                    const dateHeader = document.createElement('h3');
                    dateHeader.classList.add('date-header');
                    dateHeader.textContent = date;

                    const imageContainer = document.createElement('div');
                    imageContainer.classList.add('image-container');

                    images.forEach(image => {
                        const imageCard = document.createElement('div');
                        imageCard.classList.add('image-card');

                        imageCard.innerHTML = `
                            <img src="${image.image_url}" alt="Uploaded Image">
                            <p>${image.comment || 'No comment'}</p>
                        `;

                        imageContainer.appendChild(imageCard);
                    });

                    dateGroup.appendChild(dateHeader);
                    dateGroup.appendChild(imageContainer);
                    galleryContainer.appendChild(dateGroup);
                }
            } else {
                galleryContainer.innerHTML = `<p>${data.message || '画像が見つかりませんでした'}</p>`;
            }
        } catch (error) {
            console.error('画像取得中にエラーが発生しました:', error);
            galleryContainer.innerHTML = '<p>画像を取得できませんでした。</p>';
        }
    });





    function escapeToYahoo() {
      // history.replaceState(null, null, '/'); // 現在の履歴を空ページに置き換え
      localStorage.removeItem('authKey');
           window.location.href = 'https://www.yahoo.co.jp';

       }













    </script>
</body>
</html>
