<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ホテル清掃マップ（フロント）</title>
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    background: #f5f5f5;
    margin: 0;
    padding: 20px;
    user-select: none;
  }

  h2 {
    text-align: center;
    margin-bottom: 20px;
  }

  .floor {
    background: #fff;
    margin-bottom: 25px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    padding: 10px 15px;
  }

  .floor h3 {
    margin: 0 0 10px 0;
    border-bottom: 2px solid #ccc;
    padding-bottom: 5px;
  }

  .rooms {
    display: flex;
    justify-content: space-between;
    width: 100%;
  }

  /* ======= タイプ別カラー（淡く） ======= */
  .TP, .TR, .TS { background-color: #f2e6ff; }
  .TD, .TDS     { background-color: #ffeacc; }
  .TM, .TMS     { background-color: #fff6cc; }
  .SM, .SMS     { background-color: #e6f7e6; }
  .TC           { background-color: #e6f2ff; }
  .DS, .DSS     { background-color: #ffe6e6; }


  /* ===== 右クリックメニュー ===== */
  .context-menu {
    position: absolute;
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 6px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    display: none;
    z-index: 9999;
    width: 200px;
  }
  .context-menu ul {
    list-style: none;
    padding: 5px;
    margin: 0;
  }
  .context-menu li {
    padding: 6px 10px;
    cursor: pointer;
    border-radius: 4px;
    transition: background 0.15s;
  }
  .context-menu li:hover {
    background: #e6f0ff;
  }
  .room-408, .room-417 {
  flex: 0 0 7% !important;   /* 横幅を8%に変更（デフォはcalc(100%/21)） */
}
.room-508, .room-517 {
flex: 0 0 7% !important;   /* 横幅を8%に変更（デフォはcalc(100%/21)） */
}
.room-608, .room-617 {
flex: 0 0 7% !important;   /* 横幅を8%に変更（デフォはcalc(100%/21)） */
}
.room-708, .room-717 {
flex: 0 0 7% !important;   /* 横幅を8%に変更（デフォはcalc(100%/21)） */
}
.room-808, .room-817 {
flex: 0 0 7% !important;   /* 横幅を8%に変更（デフォはcalc(100%/21)） */
}
.room-901{
  flex: 0 0 4% !important;
}

.room-401,
.room-402,
.room-403,
.room-404,
.room-405,
.room-406,
.room-407,
.room-409,
.room-410,
.room-411,
.room-412,
.room-413,
.room-414,
.room-415,
.room-416,
.room-418,
.room-419,
.room-420,
.room-421 {
flex: 0 0 4% !important;   /* 横幅を8%に変更（デフォはcalc(100%/21)） */
}

.room-501,
.room-502,
.room-503,
.room-505,
.room-505,
.room-506,
.room-507,
.room-509,
.room-510,
.room-511,
.room-512,
.room-513,
.room-515,
.room-515,
.room-516,
.room-518,
.room-519,
.room-520,
.room-521 {
flex: 0 0 4% !important;   /* 横幅を8%に変更（デフォはcalc(100%/21)） */
}

.room-601,
.room-602,
.room-603,
.room-606,
.room-606,
.room-606,
.room-607,
.room-609,
.room-610,
.room-611,
.room-612,
.room-613,
.room-616,
.room-616,
.room-616,
.room-618,
.room-619,
.room-620,
.room-621 {
flex: 0 0 4% !important;   /* 横幅を8%に変更（デフォはcalc(100%/21)） */
}

.room-701,
.room-702,
.room-703,
.room-704,
.room-705,
.room-706,
.room-707,
.room-709,
.room-710,
.room-711,
.room-712,
.room-713,
.room-714,
.room-715,
.room-716,
.room-718,
.room-719,
.room-720,
.room-721 {
flex: 0 0 4% !important;   /* 横幅を8%に変更（デフォはcalc(100%/21)） */
}

.room-801,
.room-802,
.room-803,
.room-804,
.room-805,
.room-806,
.room-807,
.room-809,
.room-810,
.room-811,
.room-812,
.room-813,
.room-814,
.room-815,
.room-816,
.room-818,
.room-819,
.room-820,
.room-821 {
flex: 0 0 4% !important;   /* 横幅を8%に変更（デフォはcalc(100%/21)） */
}

.room-901,
.room-904,
.room-905,
.room-909,
.room-910,
.room-911,
.room-912,
.room-913,
.room-916,
.room-918,
.room-921 {
flex: 0 0 4% !important;   /* 横幅を8%に変更（デフォはcalc(100%/21)） */
}

.room-902,
.room-907,
.room-914,
.room-919 {
flex: 0 0 9% !important;   /* 横幅を8%に変更（デフォはcalc(100%/21)） */
}

.room-908,
.room-917 {
flex: 0 0 7% !important;   /* 横幅を8%に変更（デフォはcalc(100%/21)） */
}

.room-1001,
.room-1004,
.room-1005,
.room-1009,
.room-1010,
.room-1011,
.room-1012,
.room-1013,
.room-1016,
.room-1018,
.room-1021 {
  flex: 0 0 4% !important;   /* 細い部屋（デフォ 4%） */
}

.room-1002,
.room-1007,
.room-1014,
.room-1019 {
  flex: 0 0 9% !important;   /* 広めの部屋（デフォ 9%） */
}

.room-1008,
.room-1017 {
  flex: 0 0 7% !important;   /* 中間サイズ */
}

.room-1101,
.room-1104,
.room-1107,
.room-1109,
.room-1110,
.room-1111,
.room-1112,
.room-1113,
.room-1116,
.room-1118,
.room-1121 {
  flex: 0 0 4% !important;   /* 細い部屋（デフォ 4%） */
}

.room-1102,
.room-1105,
.room-1114,
.room-1119 {
  flex: 0 0 9% !important;   /* 広めの部屋（デフォ 9%） */
}

.room-1108,
.room-1117 {
  flex: 0 0 7% !important;   /* 中間サイズ */
}

.room-1201 {
flex: 0 0 14% !important;   /* 横幅を8%に変更（デフォはcalc(100%/21)） */
}

.room-1205 {
flex: 0 0 15% !important;   /* 横幅を8%に変更（デフォはcalc(100%/21)） */
}

.room-1202,
.room-1203,
.room-1204,
.room-1206,
.room-1207,
.room-1208,
.room-1209,
.room-1210,
.room-1211,
.room-1212 {
  flex: 0 0 7% !important;
}


/* ===== アイコンを見やすく改善 ===== */
.room-status {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
}

.room .icon,
.room-status {
  font-size: 26px; /* ← ちょっと大きめ */
  position: relative;
}


/* 絵文字（アイコン）本体を前面に */
.room-status span,
.room-status {
  position: relative;
  z-index: 1;
  text-shadow: 0 1px 3px rgba(0,0,0,0.3);
}

.room {
  border-radius: 8px;
  color: #333;
  background: #eee;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  height: 90px;
  cursor: pointer;
  border: 2px solid transparent;
  transition: transform 0.2s, border-color 0.2s;
  box-sizing: border-box;
  text-align: center;
  font-size: 12px;
}

.room:hover {
  transform: scale(1.05);
}

.room-header {
  font-weight: bold;
  font-size: 11px;
  margin-top: 3px;
}

.room-status{
  border-top: 0.3px solid #333
}


/* ステータス別に色を微調整 */
.掃除前 .room-status { color: #ff6600; }   /* オレンジ（🧹） */
.確認済 .room-status { color: #009900; }   /* 緑（✅） */
.宿泊中 .room-status { color: #333366; }   /* ネイビー（🛏️） */
.連泊中 .room-status { color: #3366ff; }   /* ブルー（🔁） */
.未使用 .room-status { color: #666; }      /* グレー（⬜） */

/* ===== 右クリックメニュー（モダンガラス風） ===== */
.context-menu {
  position: absolute;
  background: rgba(255, 255, 255, 0.7);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 12px;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.25);
  display: none;
  z-index: 9999;
  width: 220px;
  overflow: hidden;
  animation: fadeIn 0.15s ease-out;
}

.context-menu ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.context-menu li {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 14px;
  font-size: 15px;
  font-weight: 500;
  color: #333;
  cursor: pointer;
  transition: all 0.2s ease;
  border-bottom: 1px solid rgba(255,255,255,0.2);
}

.context-menu li:last-child {
  border-bottom: none;
}

.context-menu li:hover {
  background: rgba(0, 123, 255, 0.15);
  color: #0044aa;
  transform: translateX(4px);
}

.context-menu li:active {
  background: rgba(0, 123, 255, 0.25);
  transform: scale(0.98);
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}
/* ===== 凡例（Legend）右下固定 ===== */
#legend {
  position: fixed;
  bottom: 70px;
  right: 20px;
  background: rgba(255, 255, 255, 0.85);
  backdrop-filter: blur(8px);
  border-radius: 10px;
  border: 1px solid rgba(200, 200, 200, 0.6);
  box-shadow: 0 2px 10px rgba(0,0,0,0.25);
  padding: 10px 14px;
  font-size: 13px;
  z-index: 10000;
  width: 180px;
  opacity: 1;
  transform: translateY(0);
  transition: all 0.3s ease;
}

#legend.hidden {
  opacity: 0;
  transform: translateY(20px);
  pointer-events: none;
}

#legend h4 {
  margin: 0 0 6px 0;
  font-size: 14px;
  text-align: center;
  border-bottom: 1px solid rgba(150,150,150,0.3);
  padding-bottom: 4px;
}

.legend-item {
  display: flex;
  align-items: center;
  margin: 3px 0;
  gap: 5px;
}

.legend-item .icon {
  font-size: 16px;
}

.legend-color {
  display: inline-block;
  width: 18px;
  height: 12px;
  border-radius: 3px;
  border: 1px solid #aaa;
  margin-right: 4px;
  vertical-align: middle;
}

/* 凡例ボタン：右上固定 */
#toggleLegendBtn {
  background: #007bff;
  color: white;
  border: none;
  border-radius: 20px;
  padding: 7px 16px;
  font-size: 13px;
  cursor: pointer;
  box-shadow: 0 3px 6px rgba(0,0,0,0.25);
  transition: background 0.2s, transform 0.2s;
}

#toggleLegendBtn:hover {
  background: #0056c1;
  transform: translateY(-2px);
}
/* ===== ヘッダー（タイトル＋凡例ボタン） ===== */
.header {
  position: sticky;         /* ← スクロールしても上に固定 */
  top: 0;
  z-index: 1000;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: linear-gradient(to right, #ffffff, #f0f6ff);
  border-bottom: 1px solid #ccc;
  padding: 10px 20px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

.header {
  height:40px;
  overflow:hidden
}
.header img {
  height: 100%;
}

.header h2 {
  margin: 0;
  font-size: 20px;
  font-weight: 600;
}

/* 凡例切り替えボタン */
#toggleLegendBtn {
  background: #007bff;
  color: white;
  border: none;
  border-radius: 20px;
  padding: 6px 14px;
  font-size: 13px;
  cursor: pointer;
  box-shadow: 0 3px 6px rgba(0,0,0,0.2);
  transition: background 0.2s, transform 0.2s;
}

#toggleLegendBtn:hover {
  background: #0056c1;
  transform: translateY(-2px);
}

.header-right {
  display: flex;
  gap: 10px;
}

/* =============================
   🔹 ヘッダー右側ボタン共通スタイル
   ============================= */
.header-right button {
  font-family: "Segoe UI", "Hiragino Sans", sans-serif;
  font-weight: 600;
  font-size: 14px;
  border: none;
  border-radius: 25px;
  padding: 6px 18px;
  margin-left: 10px;
  cursor: pointer;
  transition: all 0.25s ease;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.15);
}

/* 🟢 設定ボタン */
#masterBtn {
  background: #28a745;
  color: #fff;
}
#masterBtn:hover {
  background: #218838;
  transform: translateY(-1px);
}

/* 📋 アメニティ依頼一覧ボタン（グレー系） */
#amenityListBtn {
  background: #fff;
  color: #333;
  border: 2px solid #ccc;
}
#amenityListBtn:hover {
  background: #f5f5f5;
  border-color: #888;
  transform: translateY(-1px);
}

/* 🔵 凡例ボタン */
#toggleLegendBtn {
  background: #007bff;
  color: white;
}
#toggleLegendBtn:hover {
  background: #0069d9;
  transform: translateY(-1px);
}

/* =============================
   ヘッダー全体レイアウト
   ============================= */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 30px;
  background: linear-gradient(to right, #f9fbff, #f1f6fb);
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.header img {
  height: 42px;
  object-fit: contain;
}

.header-right {
  display: flex;
  align-items: center;
}

/* ===== モーダル共通 ===== */
.modal {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.5);
  justify-content: center;
  align-items: center;
  z-index: 20000;
  animation: fadeIn 0.2s ease;
}
.modal-content {
  background: #fff;
  border-radius: 14px;
  padding: 25px 30px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.3);
  min-width: 360px;
  position: relative;
  text-align: center;
  animation: scaleIn 0.2s ease-out;
}
.modal-content.large {
  min-width: 700px;
}
.modal-content h3 {
  margin-bottom: 18px;
  font-size: 20px;
}
.close-btn {
  position: absolute;
  top: 10px; right: 15px;
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
  color: #888;
  transition: color 0.2s;
}
.close-btn:hover { color: #000; }

/* ボタン配置 */
.action-buttons {
  display: flex;
  gap: 20px;
  justify-content: center;
}
.action-buttons button {
  background: #007bff;
  border: none;
  border-radius: 8px;
  color: white;
  font-size: 15px;
  padding: 10px 18px;
  cursor: pointer;
  box-shadow: 0 3px 6px rgba(0,0,0,0.2);
  transition: background 0.2s, transform 0.1s;
}
.action-buttons button:hover {
  background: #0056c1;
  transform: translateY(-2px);
}
.action-buttons button:disabled {
  background: #ccc;
  cursor: not-allowed;
}

/* ステータス選択グリッド */
.status-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 12px;
}
.status-option {
  background: #f9f9f9;
  border: 2px solid #ccc;
  border-radius: 10px;
  padding: 15px 10px;
  cursor: pointer;
  transition: all 0.2s;
}
.status-option:hover {
  border-color: #007bff;
  background: #eef4ff;
}
.status-option span {
  display: block;
  font-size: 22px;
}
.status-option small {
  display: block;
  margin-top: 5px;
  font-weight: 600;
}
@keyframes scaleIn {
  from { transform: scale(0.95); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}

/* ==========================
   🔄 ローディングオーバーレイ
========================== */
.loading-overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background: rgba(255,255,255,0.6);
  backdrop-filter: blur(4px);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 30000;
  transition: opacity 0.3s ease;
}
.loading-overlay.hidden {
  opacity: 0;
  display: none;
}

/* スピナー */
.spinner {
  width: 60px;
  height: 60px;
  border: 6px solid rgba(0,0,0,0.1);
  border-top: 6px solid #007bff;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 15px;
}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
.loading-overlay p {
  font-size: 16px;
  color: #333;
  font-weight: 500;
  letter-spacing: 0.05em;
}

/* ================================
   🏨 部屋詳細モーダル 完全修正版
================================ */
#roomDetailModal .modal-content {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(14px);
  border-radius: 18px;
  padding: 35px 45px 40px;
  box-shadow: 0 6px 24px rgba(0, 0, 0, 0.25);
  color: #333;
  max-width: 640px;
  width: 90%;
  animation: fadeSlideIn 0.25s ease-out;
  position: relative;
}

#roomDetailModal h3 {
  text-align: center;
  font-size: 22px;
  margin-bottom: 25px;
  color: #004c91;
  border-bottom: 2px solid rgba(0, 123, 255, 0.3);
  padding-bottom: 8px;
  letter-spacing: 0.05em;
}

/* === 入力フォーム === */
#roomDetailForm .form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 18px 28px;
  text-align: left;
}

#roomDetailForm label {
  display: flex;
  flex-direction: column;
  gap: 6px;
  font-weight: 600;
  font-size: 14px;
  color: #222;
}

#roomDetailForm input,
#roomDetailForm textarea {
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 8px 10px;
  font-size: 14px;
  background: #fff;
  transition: all 0.2s ease;
  width: 100%;
  box-sizing: border-box;
}

#roomDetailForm input:focus,
#roomDetailForm textarea:focus {
  border-color: #007bff;
  box-shadow: 0 0 4px rgba(0, 123, 255, 0.4);
  outline: none;
}

#roomDetailForm textarea {
  grid-column: 1 / 3;
  resize: vertical;
  min-height: 80px;
}

/* === ボタン配置 === */
#roomDetailModal .action-buttons {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-top: 28px;
}

#roomDetailModal .action-buttons button {
  background: linear-gradient(135deg, #007bff, #00a2ff);
  border: none;
  border-radius: 10px;
  color: white;
  font-size: 15px;
  font-weight: 600;
  padding: 10px 28px;
  cursor: pointer;
  box-shadow: 0 4px 10px rgba(0, 123, 255, 0.25);
  transition: all 0.2s ease;
}

#roomDetailModal .action-buttons button:hover {
  transform: translateY(-2px);
  background: linear-gradient(135deg, #0060d1, #0088e0);
}

#roomDetailModal .action-buttons button:active {
  transform: scale(0.97);
}

/* === 閉じるボタン（右上固定） === */
#roomDetailModal .close-btn {
  position: absolute;
  top: 14px;
  right: 20px;
  background: #007bff;
  color: white;
  font-weight: bold;
  font-size: 13px;
  border: none;
  border-radius: 20px;
  padding: 6px 14px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
}

#roomDetailModal .close-btn:hover {
  background: #005ec4;
}

/* === アニメーション === */
@keyframes fadeSlideIn {
  from {
    transform: translateY(20px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

#amenityListTableContainer {
  max-height: 400px;
  overflow-y: auto;
  border-radius: 8px;
  box-shadow: inset 0 0 8px rgba(0,0,0,0.1);
}

#amenityListTable {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
  background: #fff;
}

#amenityListTable th {
  background: #007bff;
  color: white;
  padding: 8px;
  position: sticky;
  top: 0;
}

#amenityListTable td {
  border-bottom: 1px solid #ddd;
  padding: 6px 10px;
  text-align: center;
}

#amenityListTable tr:hover {
  background: #f2f8ff;
}

#amenityListTable button {
  background: #28a745;
  color: white;
  border: none;
  border-radius: 5px;
  padding: 4px 10px;
  cursor: pointer;
  font-size: 13px;
  transition: all 0.2s;
}

#amenityListTable button:hover {
  background: #218838;
}




</style>
</head>
<body>
  <header class="header">
    <img src="./img/logo.png" alt="RoomSync ロゴ">

    <div class="header-right">
      <button id="masterBtn">⚙️ 設定</button>
      <button id="amenityListBtn">📋 アメニティ依頼一覧</button>
      <button id="toggleLegendBtn">凡例表示</button>
    </div>
  </header>



<div id="map"></div>

<!-- 右クリックメニュー -->
<!-- <div class="context-menu" id="contextMenu">
  <ul>
    <li data-action="掃除依頼">🧹 掃除依頼</li>
    <li data-action="アメニティ交換">🧴 アメニティ交換</li>
    <li data-action="充電器回収">🔌 充電器回収</li>
    <li data-action="延長コード回収">🔋 延長コード回収</li>
  </ul>
</div> -->

<div id="legend" class="hidden">
  <h4>凡例</h4>
  <div class="legend-item"><span class="icon">🛏️</span> 宿泊中</div>
  <div class="legend-item"><span class="icon">🔁</span> 連泊中</div>
  <div class="legend-item"><span class="icon">🧹</span> 掃除前</div>
  <div class="legend-item"><span class="icon">✅</span> 確認済／使用可能</div>
  <div class="legend-item"><span class="icon">📘</span> 予約済</div>
  <div class="legend-item"><span class="icon">🛠️</span> 故障中・点検中</div>
  <div class="legend-item"><span class="icon">☒</span> 使用不可</div>
  <div class="legend-item"><span class="icon">⬜</span> 未使用</div>
</div>

<!-- アクション選択モーダル -->
<div id="actionModal" class="modal">
  <div class="modal-content">
    <h3>どの操作を登録しますか？</h3>
    <div class="action-buttons">
      <button id="statusChangeBtn"> 部屋ステータス変更</button>
      <button id="amenityBtn" disabled>アメニティ・他依頼</button>
    </div>
    <button class="close-btn">✖</button>
  </div>
</div>

<!-- ステータス選択モーダル -->
<div id="statusModal" class="modal">
  <div class="modal-content large">
    <h3>部屋ステータスを選択</h3>
    <div id="statusGrid" class="status-grid"></div>
    <button class="close-btn">✖</button>
  </div>
</div>

<!-- アメニティ選択モーダル -->
<!-- アメニティ操作タイプ選択 -->
<div id="amenityTypeModal" class="modal">
  <div class="modal-content">
    <h3>どの依頼をしますか？</h3>
    <div class="action-buttons">
      <button class="amenity-type-btn" data-type="交換">🔄 交換</button>
      <button class="amenity-type-btn" data-type="補充">🧴 補充</button>
      <button class="amenity-type-btn" data-type="回収">♻️ 回収</button>
    </div>
    <button class="close-btn">✖</button>
  </div>
</div>

<!-- アメニティ一覧選択 -->
<div id="amenityModal" class="modal">
  <div class="modal-content large">
    <h3>アメニティを選択してください</h3>
    <div id="amenityGrid" class="status-grid"></div>
    <button class="close-btn">✖</button>
  </div>
</div>

<!-- 返却先モーダル -->
<div id="returnModal" class="modal">
  <div class="modal-content">
    <h3>どこへ返却しますか？</h3>
    <div class="action-buttons">
      <button id="returnFrontBtn">フロント</button>
      <button id="returnStorageBtn">倉庫室</button>
    </div>
    <button class="close-btn">✖</button>
  </div>
</div>

<!-- 🔄 ローディングオーバーレイ -->
<div id="loadingOverlay" class="loading-overlay hidden">
  <div class="spinner"></div>
  <p>処理中です…</p>
</div>

<!-- 部屋詳細モーダル -->
<div id="roomDetailModal" class="modal">
  <div class="modal-content large">
    <h3>部屋情報詳細</h3>

    <form id="roomDetailForm">
      <div class="form-grid">
        <label>宿泊者名：
          <input type="text" id="guestName" name="guestName">
        </label>
        <label>チェックアウト予定：
          <input type="time" id="checkoutTime" name="checkoutTime">
        </label>
        <label>人数：
          <input type="number" id="guestCount" name="guestCount" min="1" max="10">
        </label>
        <label>備考：
          <textarea id="notes" name="notes" rows="3"></textarea>
        </label>
      </div>

      <div class="action-buttons">
        <button type="button" id="saveRoomDetailBtn">登録</button>
        <button type="button" class="close-btn">✖ 閉じる</button>
      </div>
    </form>
  </div>
</div>

<!-- アメニティ依頼一覧モーダル -->
<div id="amenityListModal" class="modal">
  <div class="modal-content large">
    <h3>📋 アメニティ依頼一覧</h3>
    <div id="amenityListTableContainer">
      <table id="amenityListTable">
        <thead>
          <tr>
            <th>部屋番号</th>
            <th>依頼内容</th>
            <th>種別</th>
            <th>返却先</th>
            <th>登録日時</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody id="amenityListBody">
          <tr><td colspan="6" style="text-align:center;">データを読み込み中...</td></tr>
        </tbody>
      </table>
    </div>
    <div class="action-buttons">
      <button class="close-btn">✖ 閉じる</button>
    </div>
  </div>
</div>







<script>
const types = ["TP","TD","TM","SM","TC","DS"];
const statuses = ["宿泊中","連泊中","掃除前","確認済","未使用"];
// ===========================
// 🏨 部屋状態アイコン一覧
// ===========================
const icons = {
  "available": "✅",   // 使用可能（確認済）
  "occupied": "🛏️",   // 宿泊中
  "stayover": "🔁",    // 連泊中（追加）
  // "cleaning": "🧹",    // 清掃中
  "dirty": "🧹",       // 清掃前
  "maintenance": "🛠️", // 故障・点検中（追加）
  "reserved": "📘",     // 予約済み（追加）
  "outofservice": "🚫", // 使用停止中（追加）
  "unavailable": "☒",  // 未使用（または一時閉鎖）

};


// ========================================
// 🎨 色設定：タイプ or 部屋番号ごとに自由変更
// ========================================
const roomColors = {
  // タイプ別（デフォルト）
  TP: "#f2e6ff",
  TD: "#ffeacc",
  TM: "#fff6cc",
  SM: "#e6f7e6",
  TC: "#e6f2ff",
  DS: "#ffe6e6",

  // 個別設定（優先される）
  "1201": "#ffebf0",  // 薄ピンク
  "1202": "#ebf8ff",  // 薄水色
  "804":  "#f7ffe6",  // 薄黄緑
  "501":  "#fff0e6",  // ベージュ
  "401": "#99e6b3",
  "402": "#66b3ff",
  "403": "#66b3ff",
  "404": "#66b3ff",
  "405": "#66b3ff",
  "406": "#ebf8ff",
  "407": "#ebf8ff",
  "408": "#ffeb3b",
  "409": "#66b3ff",
  "410": "#66b3ff",
  "411": "#ffb3b3",
  "412": "#66b3ff",
  "413": "#66b3ff",
  "414": "#99e6b3",
  "415": "#66b3ff",
  "416": "#66b3ff",
  "417": "#ffeb3b",
  "418": "#99e6b3",
  "419": "#66b3ff",
  "420": "#66b3ff",
  "421": "#66b3ff",
  // ==== 5F（501〜521） ====
"501": "#66b3ff",
"502": "#66b3ff",
"503": "#66b3ff",
"504": "#66b3ff",
"505": "#66b3ff",
"506": "#66b3ff",
"507": "#66b3ff",
"508": "#ffeb3b",
"509": "#66b3ff",
"510": "#66b3ff",
"511": "#ffb3b3",
"512": "#66b3ff",
"513": "#66b3ff",
"514": "#99e6b3",
"515": "#66b3ff",
"516": "#66b3ff",
"517": "#ffeb3b",
"518": "#99e6b3",
"519": "#66b3ff",
"520": "#66b3ff",
"521": "#66b3ff",

// ==== 6F（601〜621） ====
"601": "#66b3ff",
"602": "#66b3ff",
"603": "#66b3ff",
"604": "#66b3ff",
"605": "#66b3ff",
"606": "#66b3ff",
"607": "#66b3ff",
"608": "#ffeb3b",
"609": "#66b3ff",
"610": "#66b3ff",
"611": "#ffb3b3",
"612": "#66b3ff",
"613": "#66b3ff",
"614": "#99e6b3",
"615": "#66b3ff",
"616": "#66b3ff",
"617": "#ffeb3b",
"618": "#99e6b3",
"619": "#66b3ff",
"620": "#66b3ff",
"621": "#66b3ff",

// ==== 7F（701〜721） ====
"701": "#66b3ff",
"702": "#66b3ff",
"703": "#66b3ff",
"704": "#66b3ff",
"705": "#66b3ff",
"706": "#66b3ff",
"707": "#66b3ff",
"708": "#ffeb3b",
"709": "#66b3ff",
"710": "#66b3ff",
"711": "#ffb3b3",
"712": "#66b3ff",
"713": "#66b3ff",
"714": "#99e6b3",
"715": "#66b3ff",
"716": "#66b3ff",
"717": "#ffeb3b",
"718": "#99e6b3",
"719": "#66b3ff",
"720": "#66b3ff",
"721": "#66b3ff",

// ==== 8F（801〜821） ====
"801": "#66b3ff",
"802": "#66b3ff",
"803": "#66b3ff",
"804": "#66b3ff",
"805": "#66b3ff",
"806": "#66b3ff",
"807": "#66b3ff",
"808": "#ffeb3b",
"809": "#66b3ff",
"810": "#66b3ff",
"811": "#ffb3b3",
"812": "#66b3ff",
"813": "#66b3ff",
"814": "#99e6b3",
"815": "#66b3ff",
"816": "#66b3ff",
"817": "#ffeb3b",
"818": "#99e6b3",
"819": "#66b3ff",
"820": "#66b3ff",
"821": "#66b3ff",

// ==== 9F（901〜917） ====
"901": "#99e6b3",
"902": "#ff8800",
"904": "#99e6b3",
"905": "#99e6b3",
"907": "#ff8800",
"908": "#ffeb3b",
"909": "#99e6b3",
"910": "#99e6b3",
"911": "#ffb3b3",
"912": "#99e6b3",
"913": "#99e6b3",
"914": "#ff8800",
"916": "#99e6b3",
"917": "#ffeb3b",
"918": "#99e6b3",
"919": "#ff8800",
"921": "#99e6b3",

"1001": "#99e6b3",
"1002": "#ff8800",
"1004": "#99e6b3",
"1005": "#99e6b3",
"1007": "#ff8800",
"1008": "#ffeb3b",
"1009": "#99e6b3",
"1010": "#99e6b3",
"1011": "#ffb3b3",
"1012": "#99e6b3",
"1013": "#99e6b3",
"1014": "#ff8800",
"1016": "#99e6b3",
"1017": "#ffeb3b",
"1018": "#99e6b3",
"1019": "#ff8800",
"1021": "#99e6b3",

"1101": "#99e6b3",
"1102": "#ff8800",
"1104": "#99e6b3",
"1105": "#ff8800",
"1107": "#99e6b3",
"1108": "#ffeb3b",
"1109": "#99e6b3",
"1110": "#99e6b3",
"1111": "#ffb3b3",
"1112": "#99e6b3",
"1113": "#99e6b3",
"1114": "#ff8800",
"1116": "#99e6b3",
"1117": "#ffeb3b",
"1118": "#99e6b3",
"1119": "#ff8800",
"1121": "#99e6b3",

"1201" : "#cc99ff",
"1202" : "#ccccff",
"1203" : "#ccccff",
"1204" : "#ccccff",
"1205" : "#9933ff",
"1206" : "#ccccff",
"1207" : "#ccccff",
"1208" : "#ccccff",
"1209" : "#ccccff",
"1210" : "#ccccff",
"1211" : "#ccccff",
"1212" : "#ccccff",



};

async function showLoading() {
  console.log('kokoni deteru')
  const overlay = document.getElementById("loadingOverlay");
  overlay.classList.remove("hidden");
  await new Promise(r => setTimeout(r, 50)); // 💡 強制的に再描画
}

function hideLoading() {
  const overlay = document.getElementById("loadingOverlay");
  overlay.classList.add("hidden");
}





const statusLabels = {
  "available": "確認済（使用可能）",
  "occupied": "宿泊中",
  "stayover": "連泊中",
  // "cleaning": "清掃中",
  "dirty": "清掃前",
  "maintenance": "故障・点検中",
  "reserved": "予約済",
  "outofservice": "使用停止中",
  "unavailable": "未使用・閉鎖中"
};
const API_URL = "https://squid-app-ug7x6.ondigitalocean.app/api/room/status?hotel_id=1";

const map = document.getElementById("map");
const legend = document.getElementById("legend");
const toggleLegendBtn = document.getElementById("toggleLegendBtn");
let selectedRoom = null;

// ================================
// 🔹 部屋データ読み込み
// ================================
async function loadRooms() {
  try {
    showLoading()
    const res = await fetch(API_URL);
    hideLoading()
    if (!res.ok) throw new Error("API取得失敗");
    const data = await res.json();
    const rooms = data.rooms || [];
    const grouped = groupByFloor(rooms);

    console.log(rooms)

    map.innerHTML = "";

    Object.keys(grouped)
      .sort((a,b)=>b-a)
      .forEach(floor => {
        const floorDiv = document.createElement("div");
        floorDiv.className = "floor";
        floorDiv.innerHTML = `<h3>${floor}F</h3>`;

        const roomsContainer = document.createElement("div");
        roomsContainer.className = "rooms";

        grouped[floor].forEach(r => {
          const room = document.createElement("div");
          console.log(room)
          room.className = `room room-${r.room_number} ${r.status}`;
          room.dataset.room = r.room_number;
          room.dataset.status = r.status;
          room.dataset.type = r.room_type || "-";
          room.dataset.id = r.id;
          room.dataset.guest_name = r.guest_name || "";
          room.dataset.checkout_time = r.checkout_time || "";
          room.dataset.guest_count = r.guest_count || "";
          room.dataset.notes = r.notes || "";
          room.style.backgroundColor = getRoomColor(r);

          room.innerHTML = `
            <div class="room-header">
              ${r.room_number}<br><small>${r.room_type || "-"}</small>
            </div>
            <div class="room-status">${icons[r.status] || "⬜"}</div>
          `;

          // 左クリック → アクション選択モーダル
          room.addEventListener("click", () => {
            selectedRoom = room;
            openModal(actionModal);
          });

          // 右クリック → 部屋詳細モーダル
          room.addEventListener("contextmenu", (e) => {
            e.preventDefault();
            selectedRoom = room;
            openRoomDetailModal(room);
          });

          roomsContainer.appendChild(room);
        });



        floorDiv.appendChild(roomsContainer);
        map.appendChild(floorDiv);
      });
  } catch (err) {
    console.error("❌ 部屋データ取得エラー:", err);
    map.innerHTML = `<p style="color:red;">データ取得に失敗しました。</p>`;
  }
}

// ================================
// 🔹 フロアごとにグループ化
// ================================
function groupByFloor(rooms) {
  const grouped = {};
  for (const r of rooms) {
    const f = Number(r.floor);
    if (!grouped[f]) grouped[f] = [];
    grouped[f].push(r);
  }
  return grouped;
}

// ================================
// 🔹 色設定
// ================================
function getRoomColor(r) {
  const defaultColors = {
    "SM": "#e6f7e6",
    "TM": "#fff6cc",
    "TD": "#ffeacc",
    "TP": "#f2e6ff",
    "TC": "#e6f2ff",
    "DS": "#ffe6e6"
  };
  return defaultColors[r.room_type] || "#eee";
}

// ================================
// 🔹 凡例切り替え
// ================================
toggleLegendBtn.addEventListener("click", () => {
  legend.classList.toggle("hidden");
  toggleLegendBtn.textContent = legend.classList.contains("hidden") ? "凡例表示" : "凡例非表示";
});

// ================================
// 🔹 モーダル制御
// ================================
const actionModal = document.getElementById("actionModal");
const statusModal = document.getElementById("statusModal");
const statusGrid = document.getElementById("statusGrid");
const statusChangeBtn = document.getElementById("statusChangeBtn");
const closeButtons = document.querySelectorAll(".close-btn");
let currentRoom = null;

// 「部屋ステータス変更」を押した時
statusChangeBtn.addEventListener("click", () => {
  closeModal(actionModal);
  openModal(statusModal);
  renderStatusOptions();
});

// ステータス一覧を描画
function renderStatusOptions() {
  statusGrid.innerHTML = "";
  Object.entries(icons).forEach(([key, icon]) => {
    const div = document.createElement("div");
    div.className = "status-option";
    div.innerHTML = `
      <span>${icon}</span>
      <small>${statusLabels[key] || key}</small>
    `;

    div.onclick = async () => {
      if (selectedRoom) {
        selectedRoom.dataset.status = key;
        selectedRoom.querySelector(".room-status").textContent = icon;
        selectedRoom.className = `room room-${selectedRoom.dataset.room} ${key}`;

        try {
             console.log('tooteru')
          showLoading()
          console.log('tooteru2')

          const res = await fetch("https://squid-app-ug7x6.ondigitalocean.app/api/room/status", {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              room_id: selectedRoom.dataset.id,  // ← DBのidを持ってる場合
              status: key
            })
          });
          hideLoading();
          const result = await res.json();
          if (result.success) {
            console.log("✅ 更新成功:", result.message);
          } else {
            console.warn("⚠️ 更新失敗:", result.error);
          }
        } catch (err) {
          hideLoading();
          console.error("❌ 通信エラー:", err);
        }
      }

      closeModal(statusModal);
      alert(`部屋 ${selectedRoom.dataset.room} のステータスを「${statusLabels[key]}」に変更しました`);
    };


    statusGrid.appendChild(div);
  });
}

// モーダル開閉関数
function openModal(modal) { modal.style.display = "flex"; }
function closeModal(modal) { modal.style.display = "none"; }
closeButtons.forEach(btn => btn.onclick = () => closeModal(btn.closest(".modal")));
window.onclick = (e) => {
  if (e.target.classList.contains("modal")) closeModal(e.target);
};

// ============================
// 🧴 アメニティ関連モーダル制御
// ============================
// ============================
// 🧴 アメニティ依頼（交換・補充・回収）
// ============================

const amenityBtn = document.getElementById("amenityBtn");
const amenityTypeModal = document.getElementById("amenityTypeModal");
const amenityModal = document.getElementById("amenityModal");
const amenityGrid = document.getElementById("amenityGrid");
const returnModal = document.getElementById("returnModal");
const returnFrontBtn = document.getElementById("returnFrontBtn");
const returnStorageBtn = document.getElementById("returnStorageBtn");

let selectedAmenity = null;
let selectedAmenityType = null;

// 🔸 ボタン有効化
amenityBtn.disabled = false;

// 🔸 「アメニティ・他依頼」クリック → 種類選択へ
amenityBtn.addEventListener("click", () => {
  closeModal(actionModal);
  openModal(amenityTypeModal);
});

// 🔸 交換／補充／回収ボタンを押したとき
document.querySelectorAll(".amenity-type-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    selectedAmenityType = btn.dataset.type;
    closeModal(amenityTypeModal);
    openModal(amenityModal);
    renderAmenityOptions();
  });
});

// 🔸 アメニティ一覧
const amenities = [
  "まくら",
  "ハンガー",
  "充電器",
  "扇風機",
  "アイスペール",
  "延長コード",
  "加湿器",
  "喫煙→禁煙切り換え"
];

function renderAmenityOptions() {
  amenityGrid.innerHTML = "";
  amenities.forEach(item => {
    const div = document.createElement("div");
    div.className = "status-option";
    div.innerHTML = `<span></span><small>${item}</small>`;

    div.onclick = async () => {
      selectedAmenity = item;
      closeModal(amenityModal);

      // ✅ 条件分岐：交換 or 回収 → 返却先モーダル表示
      if (selectedAmenityType === "交換" || selectedAmenityType === "回収") {
        openModal(returnModal);
      }
      // ✅ 補充 → 返却先なしで即登録
      else if (selectedAmenityType === "補充") {
        const payload = {
          room_id: selectedRoom.dataset.id,
          action_type: selectedAmenityType,
          amenity: selectedAmenity
        };
        try {
          showLoading();
          const res = await fetch("https://squid-app-ug7x6.ondigitalocean.app/api/room/amenity", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
          });
          const result = await res.json();
          hideLoading();
          if (result.success) {
            alert(`部屋 ${selectedRoom.dataset.room}：${selectedAmenity} の「補充」を登録しました。`);
          } else {
            alert(`⚠️ 登録失敗: ${result.error}`);
          }
        } catch (err) {
          hideLoading();
          console.error("❌ 通信エラー:", err);
        }
        // リセット
        selectedAmenity = null;
        selectedAmenityType = null;
      }
    };

    amenityGrid.appendChild(div);
  });
}



// 🔸 返却先選択
async function handleReturn(location) {
  if (!selectedRoom || !selectedAmenityType || !selectedAmenity) return;

  const payload = {
    room_id: selectedRoom.dataset.id,
    action_type: selectedAmenityType,  // 交換／補充／回収
    amenity: selectedAmenity,
    return_to: location
  };

  try {
    showLoading()
    const res = await fetch("https://squid-app-ug7x6.ondigitalocean.app/api/room/amenity", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const result = await res.json();
    hideLoading();
    if (result.success) {
      alert(`部屋 ${selectedRoom.dataset.room}：${selectedAmenity} の「${selectedAmenityType}」を ${location} に登録しました。`);
    } else {
      alert(`⚠️ 登録失敗: ${result.error}`);
    }
  } catch (err) {
    hideLoading();
    console.error("❌ 通信エラー:", err);
  }

  // リセット
  selectedAmenity = null;
  selectedAmenityType = null;
  closeModal(returnModal);
}

returnFrontBtn.addEventListener("click", () => handleReturn("フロント"));
returnStorageBtn.addEventListener("click", () => handleReturn("倉庫室"));


console.log('yes')

const roomDetailModal = document.getElementById("roomDetailModal");
const saveRoomDetailBtn = document.getElementById("saveRoomDetailBtn");
const guestNameInput = document.getElementById("guestName");
const checkoutTimeInput = document.getElementById("checkoutTime");
const guestCountInput = document.getElementById("guestCount");
const notesInput = document.getElementById("notes");

// 開く処理
function openRoomDetailModal(roomElement) {
  const modal = document.getElementById("roomDetailModal");

  // datasetから情報を取得
  document.getElementById("guestName").value = roomElement.dataset.guest_name || "";
  document.getElementById("checkoutTime").value = roomElement.dataset.checkout_time || "";
  document.getElementById("guestCount").value = roomElement.dataset.guest_count || "";
  document.getElementById("notes").value = roomElement.dataset.notes || "";

  openModal(roomDetailModal);
}

// 保存処理
saveRoomDetailBtn.addEventListener("click", async () => {
  const payload = {
    room_id: selectedRoom.dataset.id,
    guest_name: guestNameInput.value,
    checkout_time: checkoutTimeInput.value,
    guest_count: guestCountInput.value,
    notes: notesInput.value
  };

  try {
    showLoading();
    const res = await fetch("https://squid-app-ug7x6.ondigitalocean.app/api/room/details", {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
    const result = await res.json();
    hideLoading();

    if (result.success) {
      alert("💾 部屋情報を更新しました！");
      // datasetを更新（再表示用）
      selectedRoom.dataset.guestName = payload.guest_name;
      selectedRoom.dataset.checkoutTime = payload.checkout_time;
      selectedRoom.dataset.guestCount = payload.guest_count;
      selectedRoom.dataset.notes = payload.notes;
    } else {
      alert(`⚠️ 更新失敗: ${result.error}`);
    }
  } catch (err) {
    hideLoading();
    console.error("❌ 通信エラー:", err);
  }

  closeModal(roomDetailModal);
});

const amenityListBtn = document.getElementById("amenityListBtn");
const amenityListModal = document.getElementById("amenityListModal");
const amenityListBody = document.getElementById("amenityListBody");

// ボタンクリックで一覧モーダルを開く
amenityListBtn.addEventListener("click", () => {
  openModal(amenityListModal);
  loadAmenityRequests();
});

// 依頼一覧を取得
async function loadAmenityRequests() {
  try {
    showLoading();
    const res = await fetch("https://squid-app-ug7x6.ondigitalocean.app/api/room/amenity/list"); // ← 新API
    hideLoading();
    if (!res.ok) throw new Error("API取得失敗");

    const data = await res.json();
    const list = data.requests || [];

    amenityListBody.innerHTML = "";

    if (list.length === 0) {
      amenityListBody.innerHTML = `<tr><td colspan="6" style="text-align:center;">依頼はありません。</td></tr>`;
      return;
    }

    list.forEach(req => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${req.room_number}</td>
        <td>${req.amenity}</td>
        <td>${req.action_type}</td>
        <td>${req.return_to || "-"}</td>
        <td>${new Date(req.created_at).toLocaleString("ja-JP")}</td>
        <td><button onclick="completeAmenity(${req.id})">完了</button></td>
      `;
      amenityListBody.appendChild(tr);
    });
  } catch (err) {
    hideLoading();
    console.error("❌ アメニティ一覧エラー:", err);
    amenityListBody.innerHTML = `<tr><td colspan="6" style="color:red;">データ取得に失敗しました。</td></tr>`;
  }
}

// 完了処理（削除）
async function completeAmenity(id) {
  if (!confirm("この依頼を完了として削除しますか？")) return;

  try {
    showLoading();
    const res = await fetch(`https://squid-app-ug7x6.ondigitalocean.app/api/room/amenity/${id}`, {
      method: "DELETE"
    });
    const result = await res.json();
    hideLoading();

    if (result.success) {
      alert("✅ 完了しました！");
      loadAmenityRequests(); // 再読込
    } else {
      alert("⚠️ 削除失敗: " + result.error);
    }
  } catch (err) {
    hideLoading();
    console.error("❌ 削除エラー:", err);
  }
}



// ================================
// 🚀 初期化
// ================================
loadRooms();
</script>
</body>
</html>
